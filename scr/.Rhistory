summary(lm.test2)
result.c9
source('~/Documents/projects/mimic/MIMICIII_FB/scr/helper.R')
result.c9 <- GetlinearRegression(data.raw.sepsis, 'los_icu', 'fb24hr', 0, 0)
result.c9
as.character.factor(as.data.frame(result.c9[1])['group',1])
result.c9[1]
result.c9[1]['group',1])
result.c9[1]['group',1]
result.c9[1][names(result.c9) == 'group',1]
result.c9[1][colnames(result.c9) == 'group',1]
result.c9[1][rownames(result.c9[1]) == 'group',1]
rownames(result.c9[1])
rowname(result.c9[1])
rownames(result.c9[1])
result.c9[1][which(result.c9[1][,1])=='group',1]
result.c9[1][, 1])
result.c9[1][, 1]
result.c9
nrow(result.c9[1])
a1 <- result.c9[1]
a1 <- as.data.frame(a1)
nrow(a1)
a1[rownames(a1) == 'group1', 1]
View(a1)
a1[rownames(a1) == 'group2', 1]
a1[rownames(a1) == 'group2', 2]
source('~/Documents/projects/mimic/MIMICIII_FB/scr/helper.R')
result.c9 <- GetlinearRegression(data.raw.sepsis, 'los_icu', 'fb24hr', 0, 0)
linear.result3 <- GetLinearSummeryTable(result.c9, 0)
View(linear.result3)
resultlist <- result.c9
a3 <- resultlist[3]
c321 <- as.character.factor(as.data.frame(a3)[rownames(a3) == 'group2',1])
c322<- as.character(as.data.frame(a3)[rownames(a3) == 'group2',2])
c32 <- paste(c321, 'p = ', c322)
a3
as.data.frame(a3)[rownames(a3) == 'group2',1]
rownames(a3)
c321 <- as.character.factor(as.data.frame(a3)[rownames(as.data.frame(a3)) == 'group2',1])
source('~/Documents/projects/mimic/MIMICIII_FB/scr/helper.R')
result.c9 <- GetlinearRegression(data.raw.sepsis, 'los_icu', 'fb24hr', 0, 0)
linear.result3 <- GetLinearSummeryTable(result.c9, 0)
data.pul <- subset(data.raw.sepsis, pul == 1)
data.ckd <- subset(data.raw.sepsis, renal_failure == 1)
result.c9 <- GetlinearRegression(data.pul, 'los_icu', 'fb24hr', 1, 0)
linear.result3 <- GetLinearSummeryTable(result.c9, 1)
result.c9 <- GetlinearRegression(data.ckd, 'los_icu', 'fb24hr', 0, 1)
summary(data.ckd)
summary(data.pul)
summary(data.ckd)
source('~/Documents/projects/mimic/MIMICIII_FB/scr/helper.R')
source('~/Documents/projects/mimic/MIMICIII_FB/scr/helper.R')
result.c9 <- GetlinearRegression(data.ckd, 'los_icu', 'fb24hr', 0, 1)
source('~/Documents/projects/mimic/MIMICIII_FB/scr/helper.R')
result.c9 <- GetlinearRegression(data.ckd, 'los_icu', 'fb24hr', 0, 1)
summary(data.ckd)
result.c9 <- GetlinearRegression(data.ckd, 'los_icu', 'fb3hr', 0, 1)
lm.test3 <- lm(data[[y]] ~ data[[x]] + age + gender + weight + sofa + diabetes + hypertension + congestive_heart_failure + liver_disease + cancer + chronic_pulmonary + obesity + dialysis + hemoglobin + creatinine + wbc + temp_value + resp_rate + heart_rate + sys_bp + dias_bp + mean_bp + group, data = data.ckd)
lm.test3 <- lm(los_icu ~ fb24hr + age + gender + weight + sofa + diabetes + hypertension + congestive_heart_failure + liver_disease + cancer + chronic_pulmonary + obesity + dialysis + hemoglobin + creatinine + wbc + temp_value + resp_rate + heart_rate + sys_bp + dias_bp + mean_bp, data = data.ckd)
source('~/Documents/projects/mimic/MIMICIII_FB/scr/helper.R')
source('~/Documents/projects/mimic/MIMICIII_FB/scr/helper.R')
result.c9 <- GetlinearRegression(data.ckd, 'los_icu', 'fb24hr', 0, 1)
linear.result3 <- GetLinearSummeryTable(result.c9, 0)
result.c9[3]
result.c9 <- GetlinearRegression(data.pul, 'los_icu', 'fb24hr', 1, 0)
linear.result3 <- GetLinearSummeryTable(result.c9, 1)
result.c9 <- GetlinearRegression(data.raw.sepsis, 'los_icu', 'fb24hr', 0, 0)
linear.result3 <- GetLinearSummeryTable(result.c9, 0)
source('~/Documents/projects/mimic/MIMICIII_FB/scr/helper.R')
source('~/Documents/projects/mimic/MIMICIII_FB/scr/helper.R')
source('~/Documents/projects/mimic/MIMICIII_FB/scr/helper.R')
resultlist3 <- GetLogisticRegression(data.raw.sepsis, 'hospital_expire_flag', 'fb24hr', 0, 0)
result3 <- GetLogisticSummeryTable(resultlist3, 0)
View(result3)
resultlist3 <- GetLogisticRegression(data.raw.sepsis, 'icu_expire_flag', 'fb24hr', 0, 0)
result3 <- GetLogisticSummeryTable(resultlist3, 0)
source('~/Documents/projects/mimic/MIMICIII_FB/scr/helper.R')
source('~/Documents/projects/mimic/MIMICIII_FB/scr/helper.R')
resultlist3 <- GetLogisticRegression(data.raw.sepsis, 'icu_expire_flag', 'fb24hr', 0, 0)
result3 <- GetLogisticSummeryTable(resultlist3, 0)
source('~/Documents/projects/mimic/MIMICIII_FB/scr/helper.R')
result3 <- GetLogisticSummeryTable(resultlist3, 0)
write.csv(result3, '/home/bme/Documents/projects/mimic/MIMICIII_FB/results/logistic_regression_result_icu_24.csv')
resultlist3 <- GetLogisticRegression(data.pul, 'hospital_expire_flag', 'fb24hr', 1, 0)
result3 <- GetLogisticSummeryTable(resultlist3, 1)
write.csv(result3, '/home/bme/Documents/projects/mimic/MIMICIII_FB/results/logistic_regression_result_hos_24.csv')
write.csv(result3, '/home/bme/Documents/projects/mimic/MIMICIII_FB/results/logistic_regression_result_hos_24_pul.csv')
resultlist3 <- GetLogisticRegression(data.pul, 'icu_expire_flag', 'fb24hr', 1, 0)
result3 <- GetLogisticSummeryTable(resultlist3, 1)
write.csv(result3, '/home/bme/Documents/projects/mimic/MIMICIII_FB/results/logistic_regression_result_icu_24_pul.csv')
resultlist3 <- GetLogisticRegression(data.ckd, 'hospital_expire_flag', 'fb24hr', 0, 1)
result3 <- GetLogisticSummeryTable(resultlist3, 0)
write.csv(result3, '/home/bme/Documents/projects/mimic/MIMICIII_FB/results/logistic_regression_result_hos_24_ckd.csv')
resultlist3 <- GetLogisticRegression(data.ckd, 'icu_expire_flag', 'fb24hr', 0, 1)
result3 <- GetLogisticSummeryTable(resultlist3, 0)
write.csv(result3, '/home/bme/Documents/projects/mimic/MIMICIII_FB/results/logistic_regression_result_icu_24_ckd.csv')
resultlist3 <- GetLogisticRegression(data.raw.sepsis, 'hospital_expire_flag', 'fb24hr', 0, 0)
result3 <- GetLogisticSummeryTable(resultlist3, 0)
write.csv(result3, '/home/bme/Documents/projects/mimic/MIMICIII_FB/results/logistic_regression_result_hos_24.csv')
result.c9 <- GetlinearRegression(data.ckd, 'los_icu', 'fb24hr', 0, 1)
linear.result3 <- GetLinearSummeryTable(result.c9, 0)
write.csv(result3, '/home/bme/Documents/projects/mimic/MIMICIII_FB/results/linear_regression_result_icu_24_ckd.csv')
result.c9 <- GetlinearRegression(data.raw.sepsis, 'los_icu', 'fb24hr', 0, 0)
linear.result3 <- GetLinearSummeryTable(result.c9, 0)
write.csv(result3, '/home/bme/Documents/projects/mimic/MIMICIII_FB/results/linear_regression_result_icu_24.csv')
result.c9 <- GetlinearRegression(data.pul, 'los_icu', 'fb24hr', 1, 0)
linear.result3 <- GetLinearSummeryTable(result.c9, 1)
write.csv(result3, '/home/bme/Documents/projects/mimic/MIMICIII_FB/results/linear_regression_result_icu_24_pul.csv')
source('~/Documents/projects/mimic/MIMICIII_FB/scr/helper.R')
View(result3)
result.c9 <- GetlinearRegression(data.pul, 'los_icu', 'fb24hr', 1, 0)
linear.result3 <- GetLinearSummeryTable(result.c9, 1)
result.c9 <- GetlinearRegression(data.pul, 'los_icu', 'fb24hr', 1, 0)
linear.result3 <- GetLinearSummeryTable(result.c9, 1)
View(linear.result3)
write.csv(linear.result3, '/home/bme/Documents/projects/mimic/MIMICIII_FB/results/linear_regression_result_icu_24_pul.csv')
result.c9 <- GetlinearRegression(data.ckd, 'los_icu', 'fb24hr', 0, 1)
linear.result3 <- GetLinearSummeryTable(result.c9, 0)
write.csv(linear.result3, '/home/bme/Documents/projects/mimic/MIMICIII_FB/results/linear_regression_result_icu_24_ckd.csv')
result.c9 <- GetlinearRegression(data.raw.sepsis, 'los_icu', 'fb24hr', 0, 0)
linear.result3 <- GetLinearSummeryTable(result.c9, 0)
write.csv(linear.result3, '/home/bme/Documents/projects/mimic/MIMICIII_FB/results/linear_regression_result_icu_24.csv')
source('~/Documents/R-projects/MIMICIII_FB/scr/helper.R')
library(readr)
data.raw.sepsis <- read_csv("~/Documents/R-projects/MIMICIII_FB/data/cache_data/sepsis_02012018.csv")
mv.duration <- read_csv("~/Documents/R-projects/MIMICIII_FB/data/cache_data/mv_duration.csv")[, c(2,6)]
# remove three record that may have wrong record in fluid balance
data.raw.sepsis <- data.raw.sepsis[which(data.raw.sepsis$subject_id != '234959' & data.raw.sepsis$icustay_id != '252601' & data.raw.sepsis$icustay_id != '235479'), ]
data.raw.sepsis$age[data.raw.sepsis$age >300] <- 90
data.raw.sepsis <- data.raw.sepsis[, -c(8, 10, 13:15, 17:19, 30, 37, 38, 44, 46, 48, 50, 52, 55, 57, 59, 61, 63, 65, 66, 68, 69)]
# convert gender to 0/1, 0 as famale, 1 as male
data.raw.sepsis$gender[which(data.raw.sepsis$gender == 'M')] <- 0
data.raw.sepsis$gender[which(data.raw.sepsis$gender == 'F')] <- 1
data.raw.sepsis$icu_expire_flag[which(data.raw.sepsis$icu_expire_flag == 'Y')] <- 1
data.raw.sepsis$icu_expire_flag[which(data.raw.sepsis$icu_expire_flag == 'N')] <- 0
data.raw.sepsis[, c(5, 9, 14:22, 24:31, 37, 44)] <- lapply(data.raw.sepsis[, c(5, 9, 14:22, 24:31, 37, 44)], as.factor)
data.raw.sepsis$los_hospital <- data.raw.sepsis$los_hospital/24
data.raw.sepsis$los_icu <- data.raw.sepsis$los_icu/24
data.raw.sepsis <- merge(data.raw.sepsis[, -11], mv.duration, by = 'hadm_id', all.x = TRUE)
colnames(data.raw.sepsis)[49] <- 'Mechanical_ventilation_duration'
data.raw.sepsis$Mechanical_ventilation_duration[is.na(data.raw.sepsis$Mechanical_ventilation_duration)] <- 0
library(Hmisc)
install.packages('Hmisc')
data.raw.sepsis[, c('fb3hr', 'fb12hr', 'fb24hr', 'fb48hr', 'fb72hr')] <- data.raw.sepsis[, c('fb3hr', 'fb12hr', 'fb24hr', 'fb48hr', 'fb72hr')]/1000
# remove three variables contains many missings
data.raw.sepsis <- data.raw.sepsis[, names(data.raw.sepsis) %in% c('height', 'neutrophils', 'lactate') == FALSE]
# data interpolation
DataImpute <- function(x){
result <- impute(x, median)
}
data.raw.sepsis[, c('weight', 'resp_rate', 'temp_value', 'wbc', 'creatinine', 'hemoglobin', 'mingcs')] <- lapply(data.raw.sepsis[, c('weight', 'resp_rate', 'temp_value', 'wbc', 'creatinine', 'hemoglobin', 'mingcs')], DataImpute)
install.packages(Hmisc)
install.packages('Hmisc')
library(Hmisc)
library(dplyr)
# convert ml to L for fluid balance
data.raw.sepsis[, c('fb3hr', 'fb12hr', 'fb24hr', 'fb48hr', 'fb72hr')] <- data.raw.sepsis[, c('fb3hr', 'fb12hr', 'fb24hr', 'fb48hr', 'fb72hr')]/1000
# remove three variables contains many missings
data.raw.sepsis <- data.raw.sepsis[, names(data.raw.sepsis) %in% c('height', 'neutrophils', 'lactate') == FALSE]
# data interpolation
DataImpute <- function(x){
result <- impute(x, median)
}
data.raw.sepsis[, c('weight', 'resp_rate', 'temp_value', 'wbc', 'creatinine', 'hemoglobin', 'mingcs')] <- lapply(data.raw.sepsis[, c('weight', 'resp_rate', 'temp_value', 'wbc', 'creatinine', 'hemoglobin', 'mingcs')], DataImpute)
data.pul <- subset(data.raw.sepsis, data.raw.sepsis$pul == 1)
data.ckd <- subset(data.raw.sepsis, data.raw.sepsis$renal_failure == 1)
data <- data.raw.sepsis
glm.test2 <- glm(data[[y]] ~ data[[x]] + age + gender + weight + hemoglobin + creatinine + wbc + temp_value + resp_rate + heart_rate + mean_bp + group
, family = binomial(link='logit')
, data = data)
summary(glm.test2)
b2 <- GetORSummary(glm.test2)
rownames(b2)[2] <- x
resultlist3 <- GetLogisticRegression(data.raw.sepsis, 'hospital_expire_flag', 'fb24hr', 0, 0)
result3 <- GetLogisticSummeryTable(resultlist3, 0)
View(result3)
View(data.raw.sepsis)
source('~/Documents/R-projects/MIMICIII_FB/scr/helper.R')
library(readr)
data.raw.sepsis <- read_csv("~/Documents/R-projects/MIMICIII_FB/data/cache_data/sepsis_02012018.csv")
mv.duration <- read_csv("~/Documents/R-projects/MIMICIII_FB/data/cache_data/mv_duration.csv")[, c(2,6)]
# remove three record that may have wrong record in fluid balance
data.raw.sepsis <- data.raw.sepsis[which(data.raw.sepsis$subject_id != '234959' & data.raw.sepsis$icustay_id != '252601' & data.raw.sepsis$icustay_id != '235479'), ]
data.raw.sepsis$age[data.raw.sepsis$age >300] <- 90
data.raw.sepsis <- data.raw.sepsis[, -c(8, 10, 13:15, 17:19, 30, 37, 38, 44, 46, 48, 50, 52, 55, 57, 59, 61, 63, 65, 66, 68, 69)]
# convert gender to 0/1, 0 as famale, 1 as male
data.raw.sepsis$gender[which(data.raw.sepsis$gender == 'M')] <- 0
data.raw.sepsis$gender[which(data.raw.sepsis$gender == 'F')] <- 1
data.raw.sepsis$icu_expire_flag[which(data.raw.sepsis$icu_expire_flag == 'Y')] <- 1
data.raw.sepsis$icu_expire_flag[which(data.raw.sepsis$icu_expire_flag == 'N')] <- 0
data.raw.sepsis[, c(5, 9, 14:22, 24:31, 37, 44)] <- lapply(data.raw.sepsis[, c(5, 9, 14:22, 24:31, 37, 44)], as.factor)
data.raw.sepsis$los_hospital <- data.raw.sepsis$los_hospital/24
data.raw.sepsis$los_icu <- data.raw.sepsis$los_icu/24
data.raw.sepsis <- merge(data.raw.sepsis[, -11], mv.duration, by = 'hadm_id', all.x = TRUE)
colnames(data.raw.sepsis)[49] <- 'Mechanical_ventilation_duration'
data.raw.sepsis$Mechanical_ventilation_duration[is.na(data.raw.sepsis$Mechanical_ventilation_duration)] <- 0
library(Hmisc)
library(dplyr)
# convert ml to L for fluid balance
data.raw.sepsis[, c('fb3hr', 'fb12hr', 'fb24hr', 'fb48hr', 'fb72hr')] <- data.raw.sepsis[, c('fb3hr', 'fb12hr', 'fb24hr', 'fb48hr', 'fb72hr')]/1000
# remove three variables contains many missings
data.raw.sepsis <- data.raw.sepsis[, names(data.raw.sepsis) %in% c('height', 'neutrophils', 'lactate') == FALSE]
# data interpolation
DataImpute <- function(x){
result <- impute(x, median)
}
data.raw.sepsis[, c('weight', 'resp_rate', 'temp_value', 'wbc', 'creatinine', 'hemoglobin', 'mingcs')] <- lapply(data.raw.sepsis[, c('weight', 'resp_rate', 'temp_value', 'wbc', 'creatinine', 'hemoglobin', 'mingcs')], DataImpute)
data.pul <- subset(data.raw.sepsis, data.raw.sepsis$pul == 1)
data.ckd <- subset(data.raw.sepsis, data.raw.sepsis$renal_failure == 1)
resultlist3 <- GetLogisticRegression(data.raw.sepsis, 'hospital_expire_flag', 'fb24hr', 0, 0)
result3 <- GetLogisticSummeryTable(resultlist3, 0)
View(result3)
resultlist3[4]
a <- quantile(data[[x]])
data$group[data[[x]] >= a[1] & data[[x]] < a[2]] <- 1
data$group[data[[x]] >= a[2] & data[[x]] < a[3]] <- 2
data$group[data[[x]] >= a[3] & data[[x]] < a[4]] <- 3
data$group[data[[x]] >= a[4] & data[[x]] <= a[5]] <- 4
data$group <- factor(data$group)       #???????????????
data$group <-relevel(data$group,ref="1")        #?????????
# model 1
x <- 'fb24hr'
a <- quantile(data[[x]])
data$group[data[[x]] >= a[1] & data[[x]] < a[2]] <- 1
data$group[data[[x]] >= a[2] & data[[x]] < a[3]] <- 2
data$group[data[[x]] >= a[3] & data[[x]] < a[4]] <- 3
data$group[data[[x]] >= a[4] & data[[x]] <= a[5]] <- 4
data$group <- factor(data$group)       #???????????????
data$group <-relevel(data$group,ref="1")        #?????????
# model 1
# model 4
glm.test4 <- glm(formula = data[[y]] ~ data[[x]] + age + gender + weight + diabetes + hypertension +
congestive_heart_failure + renal_failure + liver_disease + cancer + aids + chronic_pulmonary + obesity +
eskd + hemoglobin + creatinine + wbc + temp_value + resp_rate +
heart_rate + mean_bp + pul + Mechanical_ventilation_duration + sofa + group, family = binomial(link='logit')
, data = data)
y <- 'hospital_expire_flag'
# model 4
glm.test4 <- glm(formula = data[[y]] ~ data[[x]] + age + gender + weight + diabetes + hypertension +
congestive_heart_failure + renal_failure + liver_disease + cancer + aids + chronic_pulmonary + obesity +
eskd + hemoglobin + creatinine + wbc + temp_value + resp_rate +
heart_rate + mean_bp + pul + Mechanical_ventilation_duration + sofa + group, family = binomial(link='logit')
, data = data)
b4 <- GetORSummary(glm.test4)
View(b4)
glm.test4 <- glm(formula = data[[y]] ~ data[[x]] + age + gender + weight + diabetes + hypertension +
congestive_heart_failure + renal_failure + liver_disease + cancer + aids + chronic_pulmonary + obesity +
eskd + hemoglobin + creatinine + wbc + temp_value + resp_rate +
heart_rate + mean_bp + pul + Mechanical_ventilation_duration +  group, family = binomial(link='logit')
, data = data)
b4 <- GetORSummary(glm.test4)
rownames(b4)[2] <- x
View(b4)
data <- data.raw.sepsis
a <- quantile(data[[x]])
data$group[data[[x]] >= a[1] & data[[x]] < a[2]] <- 1
data$group[data[[x]] >= a[2] & data[[x]] < a[3]] <- 2
data$group[data[[x]] >= a[3] & data[[x]] < a[4]] <- 3
data$group[data[[x]] >= a[4] & data[[x]] <= a[5]] <- 4
data$group <- factor(data$group)       #???????????????
data$group <-relevel(data$group,ref="1")        #?????????
# model 1
glm.test4 <- glm(formula = data[[y]] ~ data[[x]] + age + gender + weight + diabetes + hypertension +
congestive_heart_failure + renal_failure + liver_disease + cancer + aids + chronic_pulmonary + obesity +
eskd + hemoglobin + creatinine + wbc + temp_value + resp_rate +
heart_rate + mean_bp + pul + Mechanical_ventilation_duration +  group, family = binomial(link='logit')
, data = data)
b4 <- GetORSummary(glm.test4)
resultlist3 <- GetLogisticRegression(data.raw.sepsis, 'icu_expire_flag', 'fb24hr', 0, 0)
result3 <- GetLogisticSummeryTable(resultlist3, 0)
resultlist3[4]
y <- 'icu_expire_flag'
# model 4
glm.test4 <- glm(formula = data[[y]] ~ data[[x]] + age + gender + weight + diabetes + hypertension +
congestive_heart_failure + renal_failure + liver_disease + cancer + aids + chronic_pulmonary + obesity +
eskd + hemoglobin + creatinine + wbc + temp_value + resp_rate +
heart_rate + mean_bp + pul + Mechanical_ventilation_duration +  group, family = binomial(link='logit')
, data = data)
b4 <- GetORSummary(glm.test4)
rownames(b4)[2] <- x
View(b4)
result.c9 <- GetlinearRegression(data.raw.sepsis, 'los_icu', 'fb24hr', 0, 0)
linear.result3 <- GetLinearSummeryTable(result.c9, 0)
View(linear.result3)
y <- 'los_icu'
lm.test3 <- lm(formula = data[[y]] ~ data[[x]] + age + gender + weight + mingcs +
Mechanical_ventilation_duration + sofa + diabetes + hypertension +
congestive_heart_failure + renal_failure + liver_disease + cancer + aids + chronic_pulmonary + obesity +
eskd + hemoglobin + creatinine + wbc + temp_value + resp_rate +
heart_rate + mean_bp + pul + group, data = data)
b3 <- GetLmSummary(lm.test3)
rownames(b3)[2] <- x
View(b3)
# model 2
lm.test2 <- lm(data[[y]] ~ data[[x]] + age + gender + weight + hemoglobin + creatinine + wbc + temp_value + resp_rate + heart_rate + mean_bp + group, data = data)
b2 <- GetLmSummary(lm.test2)
rownames(b2)[2] <- x
View(b2)
source('~/Documents/R-projects/MIMICIII_FB/scr/helper.R')
result.c9 <- GetlinearRegression(data.raw.sepsis, 'los_icu', 'fb24hr', 0, 0)
linear.result3 <- GetLinearSummeryTable(result.c9, 0)
source('~/Documents/R-projects/MIMICIII_FB/scr/helper.R')
result.c9 <- GetlinearRegression(data.raw.sepsis, 'los_icu', 'fb24hr', 0, 0)
linear.result3 <- GetLinearSummeryTable(result.c9, 0)
resultlist3 <- GetLogisticRegression(data.raw.sepsis, 'hospital_expire_flag', 'fb24hr', 0, 0)
result3 <- GetLogisticSummeryTable(resultlist3, 0)
View(result3)
resultlist3[4]
glm.test1 <- glm(data.raw.sepsis$hospital_expire_flag ~ age + gender + weight + mingcs +
Mechanical_ventilation_duration + sofa + diabetes + hypertension +
congestive_heart_failure + renal_failure + liver_disease + cancer + aids + chronic_pulmonary + obesity +
eskd + hemoglobin + creatinine + wbc + temp_value + resp_rate +
heart_rate + mean_bp + pul + fb24hr, family = binomial(link='logit'), data <- data.raw.sepsis)
summary(glm.test1)
glm.result1 <- GetORSummary(glm.test1)
View(glm.result1)
glm.test1 <- glm(data.raw.sepsis$hospital_expire_flag ~ age + gender + weight +
Mechanical_ventilation_duration + diabetes + hypertension +
congestive_heart_failure + renal_failure + liver_disease + cancer + aids + chronic_pulmonary + obesity +
eskd + hemoglobin + creatinine + wbc + temp_value + resp_rate +
heart_rate + mean_bp + pul + fb24hr, family = binomial(link='logit'), data <- data.raw.sepsis)
summary(glm.test1)
glm.result1 <- GetORSummary(glm.test1)
glm.test4 <- glm(data.raw.sepsis$icu_expire_flag ~ age + gender + weight +
Mechanical_ventilation_duration + diabetes + hypertension +
congestive_heart_failure + renal_failure + liver_disease + cancer + aids + chronic_pulmonary + obesity +
eskd + hemoglobin + creatinine + wbc + temp_value + resp_rate +
heart_rate + mean_bp + pul + fb24hr, family = binomial(link='logit'), data <- data.raw.sepsis)
glm.result2 <- GetORSummary(glm.test4)
View(glm.result2)
write.csv(glm.result2, '~/Desktop/glm_icu0115.csv')
write.csv(glm.result1, '~/Desktop/glm_hos0115.csv')
glm.test1 <- glm(data.raw.sepsis$hospital_expire_flag ~ age + gender + weight +
Mechanical_ventilation_duration + diabetes + hypertension +
congestive_heart_failure + renal_failure + liver_disease + cancer + aids + chronic_pulmonary + obesity +
eskd + hemoglobin + creatinine + wbc + temp_value + resp_rate +
heart_rate + mean_bp + pul + dialysis + fb24hr, family = binomial(link='logit'), data <- data.raw.sepsis)
summary(glm.test1)
glm.result1 <- GetORSummary(glm.test1)
source('~/Documents/R-projects/MIMICIII_FB/scr/helper.R')
result.c9 <- GetlinearRegression(data.raw.sepsis, 'los_icu', 'fb24hr', 0, 0)
linear.result3 <- GetLinearSummeryTable(result.c9, 0)
View(linear.result3)
source('~/Documents/R-projects/MIMICIII_FB/scr/helper.R')
resultlist3 <- GetLogisticRegression(data.raw.sepsis, 'hospital_expire_flag', 'fb24hr', 0, 0)
result3 <- GetLogisticSummeryTable(resultlist3, 0)
View(result3)
resultlist3[4]
resultlist3 <- GetLogisticRegression(data.raw.sepsis, 'icu_expire_flag', 'fb24hr', 0, 0)
result3 <- GetLogisticSummeryTable(resultlist3, 0)
resultlist3[4]
result.c9 <- GetlinearRegression(data.raw.sepsis, 'los_icu', 'fb24hr', 0, 0)
linear.result3 <- GetLinearSummeryTable(result.c9, 0)
View(linear.result3)
source('~/Documents/R-projects/MIMICIII_FB/scr/helper.R')
result.c9 <- GetlinearRegression(data.raw.sepsis, 'los_icu', 'fb24hr', 0, 0)
linear.result3 <- GetLinearSummeryTable(result.c9, 0)
glm.test1 <- glm(data.raw.sepsis$hospital_expire_flag ~ age + gender + weight +
Mechanical_ventilation_duration + diabetes + hypertension +
congestive_heart_failure + renal_failure + liver_disease + cancer + aids + chronic_pulmonary + obesity +
eskd + hemoglobin + creatinine + wbc + temp_value + resp_rate +
heart_rate + mean_bp + pul + dialysis + fb24hr, family = binomial(link='logit'), data <- data.raw.sepsis)
summary(glm.test1)
glm.result1 <- GetORSummary(glm.test1)
write.csv(glm.result1, '~/Desktop/glm_hos0115.csv')
glm.test4 <- glm(data.raw.sepsis$icu_expire_flag ~ age + gender + weight +
Mechanical_ventilation_duration + diabetes + hypertension +
congestive_heart_failure + renal_failure + liver_disease + cancer + aids + chronic_pulmonary + obesity +
eskd + hemoglobin + creatinine + wbc + temp_value + resp_rate +
heart_rate + mean_bp + pul + dialysis + fb24hr, family = binomial(link='logit'), data <- data.raw.sepsis)
glm.result2 <- GetORSummary(glm.test4)
write.csv(glm.result2, '~/Desktop/glm_icu0115.csv')
library(readr)
final_data_25Jan2018 <- read_csv("~/Downloads/final_data_25Jan2018.csv")
View(final_data_25Jan2018)
View(final_data_25Jan2018)
data.raw.sepsis <- read_csv("~/Documents/R-projects/MIMICIII_FB/data/cache_data/sepsis_02012018.csv")
View(data.raw.sepsis)
lm.test3 <- lm(formula = los_icu ~ fb24hr + age + gender + weight + hemoglobin + creatinine + wbc + temp_value + resp_rate + heart_rate + mean_bp + Mechanical_ventilation_duration + sofa + mingcs + congestive_heart_failure+renal_failure +liver_disease +cancer+ aids  + chronic_pulmonary + obesity + eskd + pul + dialysis + group, data = data.raw.sepsis)
source('~/Documents/R-projects/MIMICIII_FB/scr/helper.R')
library(readr)
data.raw.sepsis <- read_csv("~/Documents/R-projects/MIMICIII_FB/data/cache_data/sepsis_02012018.csv")
mv.duration <- read_csv("~/Documents/R-projects/MIMICIII_FB/data/cache_data/mv_duration.csv")[, c(2,6)]
expire28 <- read_csv("~/Documents/R-projects/MIMICIII_FB/data/cache_data/expire28.csv")
# remove three record that may have wrong record in fluid balance
data.raw.sepsis <- data.raw.sepsis[which(data.raw.sepsis$subject_id != '234959' & data.raw.sepsis$icustay_id != '252601' & data.raw.sepsis$icustay_id != '235479'), ]
data.raw.sepsis$age[data.raw.sepsis$age >300] <- 90
data.raw.sepsis <- data.raw.sepsis[, -c(8, 10, 13:15, 17:19, 30, 37, 38, 44, 46, 48, 50, 52, 55, 57, 59, 61, 63, 65, 66, 68, 69)]
# convert gender to 0/1, 0 as famale, 1 as male
data.raw.sepsis$gender[which(data.raw.sepsis$gender == 'M')] <- 0
data.raw.sepsis$gender[which(data.raw.sepsis$gender == 'F')] <- 1
data.raw.sepsis$icu_expire_flag[which(data.raw.sepsis$icu_expire_flag == 'Y')] <- 1
data.raw.sepsis$icu_expire_flag[which(data.raw.sepsis$icu_expire_flag == 'N')] <- 0
data.raw.sepsis[, c(5, 9, 14:22, 24:31, 37, 44)] <- lapply(data.raw.sepsis[, c(5, 9, 14:22, 24:31, 37, 44)], as.factor)
data.raw.sepsis$los_hospital <- data.raw.sepsis$los_hospital/24
data.raw.sepsis$los_icu <- data.raw.sepsis$los_icu/24
data.raw.sepsis <- merge(data.raw.sepsis[, -11], mv.duration, by = 'hadm_id', all.x = TRUE)
colnames(data.raw.sepsis)[49] <- 'Mechanical_ventilation_duration'
data.raw.sepsis$Mechanical_ventilation_duration[is.na(data.raw.sepsis$Mechanical_ventilation_duration)] <- 0
data.raw.sepsis <- merge(data.raw.sepsis, expire28[, c(1,4)], by = 'hadm_id', all.x = TRUE)
data.raw.sepsis$expire_flag_28[is.na(data.raw.sepsis$expire_flag_28)] <- 0
data.raw.sepsis$expire_flag_28 <- as.factor(data.raw.sepsis$expire_flag_28)
# data interpolation
library(Hmisc)
library(dplyr)
# convert ml to L for fluid balance
data.raw.sepsis[, c('fb3hr', 'fb12hr', 'fb24hr', 'fb48hr', 'fb72hr')] <- data.raw.sepsis[, c('fb3hr', 'fb12hr', 'fb24hr', 'fb48hr', 'fb72hr')]/1000
# remove three variables contains many missings
data.raw.sepsis <- data.raw.sepsis[, names(data.raw.sepsis) %in% c('height', 'neutrophils', 'lactate') == FALSE]
# data interpolation
DataImpute <- function(x){
result <- impute(x, median)
}
data.raw.sepsis[, c('weight', 'resp_rate', 'temp_value', 'wbc', 'creatinine', 'hemoglobin', 'mingcs')] <- lapply(data.raw.sepsis[, c('weight', 'resp_rate', 'temp_value', 'wbc', 'creatinine', 'hemoglobin', 'mingcs')], DataImpute)
data.pul <- subset(data.raw.sepsis, data.raw.sepsis$pul == 1)
data.ckd <- subset(data.raw.sepsis, data.raw.sepsis$renal_failure == 1)
data.chf <- subset(data.raw.sepsis, data.raw.sepsis$congestive_heart_failure == 1)
data.hpt <- subset(data.raw.sepsis, data.raw.sepsis$hypertension == 1)
lm.test3 <- lm(formula = los_icu ~ fb24hr + age + gender + weight + hemoglobin + creatinine + wbc + temp_value + resp_rate + heart_rate + mean_bp + Mechanical_ventilation_duration + sofa + mingcs + congestive_heart_failure+renal_failure +liver_disease +cancer+ aids  + chronic_pulmonary + obesity + eskd + pul + dialysis + group, data = data.raw.sepsis)
source('~/Documents/R-projects/MIMICIII_FB/scr/helper.R')
library(readr)
data.raw.sepsis <- read_csv("~/Documents/R-projects/MIMICIII_FB/data/finaldata/data_sepsis_update.csv")[, -1]
# convert binary variable to factor
bincols <- colMeans((data.raw.sepsis == 1 | data.raw.sepsis == 0), na.rm = T) ==1
for (i in 1:length(bincols)){
if(bincols[i]){
data.raw.sepsis[[i]] <- as.factor(data.raw.sepsis[[i]])
}
}
# add group variable that respect to quatile of 24hr FB
data.raw.sepsis <- AddGroupVar(data.raw.sepsis, 'fb24hr')
library(tableone)
datavar <- c("age", "gender", "weight", "los_hospital", "los_icu", "Mechanical_ventilation_duration", "diabetes", "hypertension", "congestive_heart_failure", "renal_failure", "liver_disease", "cancer", "aids", "chronic_pulmonary", "obesity", "dialysis", "eskd", "pul", "sofa", "mingcs", "oasis", "hemoglobin", "creatinine", "wbc", "temp_value", "resp_rate", "heart_rate", "mean_bp",  "fb24hr", "hospital_expire_flag", "icu_expire_flag", "expire_flag_28")
base.table <- CreateTableOne(vars = datavar, strata = "group", data = data.raw.sepsis, nonnormal = F)
# add group variable that respect to quatile of 24hr FB
data.raw.sepsis <- AddGroupVar(data.raw.sepsis, 'fb24hr')
library(tableone)
datavar <- c("age", "gender", "weight", "los_hospital", "los_icu", "Mechanical_ventilation_duration", "diabetes", "hypertension", "congestive_heart_failure", "renal_failure", "liver_disease", "cancer", "aids", "chronic_pulmonary", "obesity", "dialysis", "eskd", "pul", "sofa", "mingcs", "oasis", "hemoglobin", "creatinine", "wbc", "temp_value", "resp_rate", "heart_rate", "mean_bp",  "fb24hr", "hospital_expire_flag", "icu_expire_flag", "expire_flag_28")
base.table <- CreateTableOne(vars = datavar, strata = "group", data = data.raw.sepsis, nonnormal = datavar)
# add group variable that respect to quatile of 24hr FB
data.raw.sepsis <- AddGroupVar(data.raw.sepsis, 'fb24hr')
library(tableone)
datavar <- c("age", "gender", "weight", "los_hospital", "los_icu", "Mechanical_ventilation_duration", "diabetes", "hypertension", "congestive_heart_failure", "renal_failure", "liver_disease", "cancer", "aids", "chronic_pulmonary", "obesity", "dialysis", "eskd", "pul", "sofa", "mingcs", "oasis", "hemoglobin", "creatinine", "wbc", "temp_value", "resp_rate", "heart_rate", "mean_bp",  "fb24hr", "hospital_expire_flag", "icu_expire_flag", "expire_flag_28")
base.table <- CreateTableOne(vars = datavar, strata = "group", data = data.raw.sepsis)
nonNormalVars <- c("fb24hr")
nonNormalVars <- c("age", "gender", "weight", "los_hospital", "los_icu", "Mechanical_ventilation_duration", "diabetes", "hypertension", "congestive_heart_failure", "renal_failure", "liver_disease", "cancer", "aids", "chronic_pulmonary", "obesity", "dialysis", "eskd", "pul", "sofa", "mingcs", "oasis", "hemoglobin", "creatinine", "wbc", "temp_value", "resp_rate", "heart_rate", "mean_bp",  "fb24hr", "hospital_expire_flag", "icu_expire_flag", "expire_flag_28")
base.table2 <- print(base.table, nonnormal = nonNormalVars)
# save results
a <- print(base.table2)[, -6]
g1 <- paste('Group1', '(n=', a[1,1], ')')
g2 <- paste('Group2', '(n=', a[1,2], ')')
g3 <- paste('Group3', '(n=', a[1,3], ')')
g4 <- paste('Group4', '(n=', a[1,4], ')')
colnames(a) <- c(g1, g2, g3, g4, 'p-value')
a <- a[-1, ]
write.csv(a, "~/Documents/R-projects/MIMICIII_FB/results/baseline.csv")
View(a)
View(a)
source('~/Documents/R-projects/MIMICIII_FB/scr/helper.R')
library(readr)
data.raw.sepsis <- read_csv("~/Documents/R-projects/MIMICIII_FB/data/finaldata/data_sepsis_update.csv")[, -1]
# convert binary variable to factor
bincols <- colMeans((data.raw.sepsis == 1 | data.raw.sepsis == 0), na.rm = T) ==1
for (i in 1:length(bincols)){
if(bincols[i]){
data.raw.sepsis[[i]] <- as.factor(data.raw.sepsis[[i]])
}
}
# remove 0.5% and 99.5% of fluid balance in the raw data
a <- quantile(data.raw.sepsis$fb24hr, c(.005,.995))
data.raw.sepsis <- subset(data.raw.sepsis, data.raw.sepsis$fb24hr >= a[1] & data.raw.sepsis$fb24hr <= a[2])
# add group variable that respect to quatile of 24hr FB
data.raw.sepsis <- AddGroupVar(data.raw.sepsis, 'fb24hr')
library(tableone)
datavar <- c("age", "gender", "weight", "los_hospital", "los_icu", "Mechanical_ventilation_duration", "diabetes", "hypertension", "congestive_heart_failure", "renal_failure", "liver_disease", "cancer", "aids", "chronic_pulmonary", "obesity", "dialysis", "eskd", "pul", "sofa", "mingcs", "oasis", "hemoglobin", "creatinine", "wbc", "temp_value", "resp_rate", "heart_rate", "mean_bp",  "fb24hr", "hospital_expire_flag", "icu_expire_flag", "expire_flag_28")
base.table <- CreateTableOne(vars = datavar, strata = "group", data = data.raw.sepsis)
nonNormalVars <- c("fb24hr")
# nonNormalVars <- c("age", "gender", "weight", "los_hospital", "los_icu", "Mechanical_ventilation_duration", "diabetes", "hypertension", "congestive_heart_failure", "renal_failure", "liver_disease", "cancer", "aids", "chronic_pulmonary", "obesity", "dialysis", "eskd", "pul", "sofa", "mingcs", "oasis", "hemoglobin", "creatinine", "wbc", "temp_value", "resp_rate", "heart_rate", "mean_bp",  "fb24hr", "hospital_expire_flag", "icu_expire_flag", "expire_flag_28")
base.table2 <- print(base.table, nonnormal = nonNormalVars)
# save results
a <- print(base.table2)[, -6]
g1 <- paste('Group1', '(n=', a[1,1], ')')
g2 <- paste('Group2', '(n=', a[1,2], ')')
g3 <- paste('Group3', '(n=', a[1,3], ')')
g4 <- paste('Group4', '(n=', a[1,4], ')')
colnames(a) <- c(g1, g2, g3, g4, 'p-value')
a <- a[-1, ]
write.csv(a, "~/Documents/R-projects/MIMICIII_FB/results/baseline.csv")
# data interpolation
library(Hmisc)
library(dplyr)
# convert ml to L for fluid balance
data.raw.sepsis[, c('fb3hr', 'fb12hr', 'fb24hr', 'fb48hr', 'fb72hr')] <- data.raw.sepsis[, c('fb3hr', 'fb12hr', 'fb24hr', 'fb48hr', 'fb72hr')]/1000
# data interpolation
DataImpute <- function(x){
result <- impute(x, median)
}
data.raw.sepsis[, c('weight', 'resp_rate', 'temp_value', 'wbc', 'creatinine', 'hemoglobin', 'mingcs')] <- lapply(data.raw.sepsis[, c('weight', 'resp_rate', 'temp_value', 'wbc', 'creatinine', 'hemoglobin', 'mingcs')], DataImpute)
data.pul <- subset(data.raw.sepsis, data.raw.sepsis$pul == 1)
data.ckd <- subset(data.raw.sepsis, data.raw.sepsis$renal_failure == 1)
data.chf <- subset(data.raw.sepsis, data.raw.sepsis$congestive_heart_failure == 1)
data.hpt <- subset(data.raw.sepsis, data.raw.sepsis$hypertension == 1)
# split data into four group according to x
# add a variable called group
# data.raw.sepsis <- AddGroupVar(data.raw.sepsis, 'fb24hr')
data.pul <- AddGroupVar(data.pul, 'fb24hr')
data.ckd <- AddGroupVar(data.ckd, 'fb24hr')
data.chf <- AddGroupVar(data.chf, 'fb24hr')
data.hpt <- AddGroupVar(data.hpt, 'fb24hr')
View(GetLogisticRegression)
View(GetORSummary)
